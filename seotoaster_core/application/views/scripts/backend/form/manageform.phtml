<div class="seotoaster container">
    <?php echo $this->partial('admin'.DIRECTORY_SEPARATOR.'_header.phtml', array('headerText' => 'Form properties' .' '. $this->translate('for'). ' '.$this->formForm->getElement('name')->getValue(), 'helpSection' => $this->helpSection)); ?>
    <form id="formWidget" class="_fajax _reload condensed" data-norefresh="1" action="<?php echo $this->websiteUrl?>backend/backend_form/manageform/" method="post">
        <fieldset class="content-auto">
            <p id="form-code" class="grid_6 mt0px">
                <a class="screen-size ticon-expand warning inverse fl-right" data-type="form" data-size="form-code"></a>
                <?php echo $this->formForm->getElement('code')->renderLabel(); ?>
                <?php echo $this->formForm->getElement('code')->renderViewHelper(); ?>
            </p>
            <p class="grid_6 mt0px">
                <?php echo $this->formForm->getElement('trackingCode')->renderLabel(); ?>
                <?php echo $this->formForm->getElement('trackingCode')->renderViewHelper(); ?>
            </p>
            <?php if(isset($this->trackingPageUrl)):?>
            <p class="grid_12 mt15px mb15px text-center">
                <?php echo $this->translate('Thank you page');?>:
                <a target="_blank" href="<?php echo $this->websiteUrl.$this->trackingPageUrl;?>">[ <?php echo $this->translate('Show the success page');?> ]</a>
            </p>
            <?php else:?>
            <p class="grid_12 mt15px mb10px">
                <label class="grid_4 alpha omega mt5px"><?php echo $this->translate('Create a success page');?></label>
                <select class="grid_8 omega" name="thankyouTemplate">
                    <option value="select"><?php echo $this->translate('select template');?></option>
                    <?php foreach($this->regularTemplates as $regularTemplate):?>
                        <option value="<?php echo $regularTemplate->getName();?>"><?php echo $regularTemplate->getName();?></option>
                    <?php endforeach;?>
                </select>
            </p>
            <?php endif;?>
            <p class="clear-both"></p>
            <p class="grid_6 mt10px">
                <?php echo $this->formForm->getElement('messageSuccess')->renderLabel(); ?>
                <?php echo $this->formForm->getElement('messageSuccess')->renderViewHelper(); ?>
            </p>
            <p class="grid_6 mt10px">
                <?php echo $this->formForm->getElement('messageError')->renderLabel(); ?>
                <?php echo $this->formForm->getElement('messageError')->renderViewHelper(); ?>
            </p>
            <p class="grid_12">
                <?php echo $this->formForm->getElement('mobile')->renderLabel(); ?>
                <?php echo $this->formForm->getElement('mobile')->renderViewHelper(); ?>
            </p>
            <p class="grid_4">
                <?php echo $this->formForm->getElement('enableSms')->renderLabel(); ?>
            </p>
            <p class="grid_1">
                <?php echo $this->formForm->getElement('enableSms')->renderViewHelper(); ?>
            </p>
            <p class="clear-both"></p>
            <fieldset class="grid_6 background mt10px">
                <legend class="h2 background m0px p5px"><?php echo $this->translate('Lead delivery email setup');?></legend>
                <?php if (empty($this->pageUrlAdminMailTemplate)): ?>
                    <?php $pageUrlAdminMailTemplatePreviewClass = 'hidden'; ?>
                    <?php $pageUrlAdminMailTemplatePreviewBlockClass = 'grid_12 alpha omega'; ?>
                <?php else: ?>
                    <?php $pageUrlAdminMailTemplatePreviewClass = ''; ?>
                    <?php $pageUrlAdminMailTemplatePreviewBlockClass = 'grid_10 alpha'; ?>
                <?php endif; ?>

                <p id="admin-template-page-block" class="grid_6 mt10px">
                    <?php echo $this->formForm->getElement('adminMailTemplate')->renderLabel(); ?>
                    <span id="admin-template-page-preview-selector-block" class="<?php echo $pageUrlAdminMailTemplatePreviewBlockClass;?>">
                        <?php echo $this->formForm->getElement('adminMailTemplate')->renderViewHelper(); ?>
                    </span>
                    <span id="admin-template-page-preview-link-block" class="grid_2 omega <?php echo $pageUrlAdminMailTemplatePreviewClass;?>">
                        <a id="admin-template-page-preview-link" target="_blank" href="<?php echo $this->websiteUrl.$this->pageUrlAdminMailTemplate;?>" class="ticon-arrow-right6"></a>
                    </span>
                </p>
                <p class="grid_6 mt10px">
                    <?php echo $this->formForm->getElement('adminFrom')->renderLabel(); ?>
                    <?php echo $this->formForm->getElement('adminFrom')->renderViewHelper(); ?>
                </p>
                <p class="grid_6">
                    <?php echo $this->formForm->getElement('adminFromName')->renderLabel(); ?>
                    <?php echo $this->formForm->getElement('adminFromName')->renderViewHelper(); ?>
                </p>
                <p class="grid_6">
                    <?php echo $this->formForm->getElement('adminSubject')->renderLabel(); ?>
                    <?php echo $this->formForm->getElement('adminSubject')->renderViewHelper(); ?>
                </p>
                <p class="grid_6">
                    <?php echo $this->formForm->getElement('contactEmail')->renderLabel(); ?>
                    <?php echo $this->formForm->getElement('contactEmail')->renderViewHelper(); ?>
                </p>
                <p class="grid_12" id="admin-text-code">
                    <a class="screen-size ticon-expand warning inverse fl-right" data-type="form" data-size="admin-text-code"></a>
                    <?php echo $this->formForm->getElement('adminText')->renderLabel(); ?>
                    <?php echo $this->formForm->getElement('adminText')->renderViewHelper(); ?>
                </p>
            </fieldset>

            <fieldset class="grid_6 background mt10px">
                <legend class="h2 background m0px p5px"><?php echo $this->translate('Reply email setup');?></legend>
                <div class="reply-email-flag">
                    <p>
                        <?php echo $this->formForm->getElement('replyEmail')->renderLabel(); ?>
                    </p>
                    <p>
                        <?php echo $this->formForm->getElement('replyEmail')->renderViewHelper(); ?>
                    </p>
                </div>
                <div class="reply-info grid_12 alpha omega" style="display: <?php echo $this->replyEmail ? 'none' : 'block';?>">
                    <?php if (empty($this->pageUrlReplyMailTemplate)): ?>
                        <?php $pageUrlReplyMailTemplatePreviewClass = 'hidden'; ?>
                        <?php $pageUrlReplyMailTemplatePreviewBlockClass = 'grid_12 alpha omega'; ?>
                    <?php else: ?>
                        <?php $pageUrlReplyMailTemplatePreviewClass = ''; ?>
                        <?php $pageUrlReplyMailTemplatePreviewBlockClass = 'grid_10 alpha'; ?>
                    <?php endif; ?>

                    <p id="auto-reply-template-block" class="grid_6">
                        <?php echo $this->formForm->getElement('replyMailTemplate')->renderLabel(); ?>
                        <span id="auto-reply-template-page-preview-selector-block" class="<?php echo $pageUrlReplyMailTemplatePreviewBlockClass;?>">
                            <?php echo $this->formForm->getElement('replyMailTemplate')->renderViewHelper(); ?>
                        </span>
                        <span id="auto-reply-template-page-preview-link-block" class="grid_2 omega <?php echo $pageUrlReplyMailTemplatePreviewClass;?>">
                            <a id="auto-reply-template-page-preview-link" target="_blank" href="<?php echo $this->websiteUrl.$this->pageUrlReplyMailTemplate;?>" class="ticon-arrow-right6"></a>
                        </span>
                    </p>

                    <p class="grid_6">
                        <?php echo $this->formForm->getElement('replyFrom')->renderLabel(); ?>
                        <?php echo $this->formForm->getElement('replyFrom')->renderViewHelper(); ?>
                    </p>
                    <p class="grid_6 mt5px">
                        <?php echo $this->formForm->getElement('replyFromName')->renderLabel(); ?>
                        <?php echo $this->formForm->getElement('replyFromName')->renderViewHelper(); ?>
                    </p>
                    <p class="grid_6 mt5px">
                        <?php echo $this->formForm->getElement('replySubject')->renderLabel(); ?>
                        <?php echo $this->formForm->getElement('replySubject')->renderViewHelper(); ?>
                    </p>
                    <p class="grid_12 mt5px" id="reply-text-code">
                        <a class="screen-size ticon-expand warning inverse fl-right" data-type="form" data-size="reply-text-code"></a>
                        <?php echo $this->formForm->getElement('replyText')->renderLabel(); ?>
                        <?php echo $this->formForm->getElement('replyText')->renderViewHelper(); ?>
                    </p>

                    <?php if (empty($this->pageUrlAutoReplyPdfTemplate)): ?>
                        <?php $pageUrlAutoReplyPdfTemplatePreviewClass = 'hidden'; ?>
                        <?php $pageUrlAutoReplyPdfTemplatePreviewBlockClass = 'grid_12 alpha omega'; ?>
                    <?php else: ?>
                        <?php $pageUrlAutoReplyPdfTemplatePreviewClass = ''; ?>
                        <?php $pageUrlAutoReplyPdfTemplatePreviewBlockClass = 'grid_10 alpha'; ?>
                    <?php endif; ?>

                    <p id="auto-reply-pdf-template-block" class="grid_6 mt5px">
                        <?php echo $this->formForm->getElement('autoReplyPdfTemplate')->renderLabel(); ?>
                        <span id="auto-reply-pdf-template-page-preview-selector-block" class="<?php echo $pageUrlAutoReplyPdfTemplatePreviewBlockClass;?>">
                            <?php echo $this->formForm->getElement('autoReplyPdfTemplate')->renderViewHelper(); ?>
                        </span>
                        <span id="auto-reply-pdf-template-page-preview-link-block" class="grid_2 omega <?php echo $pageUrlAutoReplyPdfTemplatePreviewClass;?>">
                            <a id="auto-reply-pdf-template-page-preview-link" target="_blank" href="<?php echo $this->websiteUrl.$this->pageUrlAutoReplyPdfTemplate;?>" class="ticon-arrow-right6"></a>
                        </span>
                    </p>
                </div>
            </fieldset>
        </fieldset>
        <input type="hidden" name="secureToken" value="<?php echo $this->secureToken;?>" />
        <input type="hidden" name="pageId" value="<?php echo $this->pageId;?>" />
		<?php echo $this->formForm->getElement('name')->renderViewHelper(); ?>
		<?php echo $this->formForm->getElement('id')->renderViewHelper(); ?>
        <?php echo $this->formForm->getElement('submit')->renderViewHelper();?>
    </form>
</div>

<script type="application/javascript">

$(document).on('change', '#admin-mail-template', function(e){
    changeEmailTemplatePreview($(e.currentTarget).val(), '#admin-template-page-preview-link', '#admin-template-page-preview-link-block', '#admin-template-page-preview-selector-block');
});

$(document).on('change', '#reply-mail-template', function(e){
    changeEmailTemplatePreview($(e.currentTarget).val(), '#auto-reply-template-page-preview-link-block', '#auto-reply-template-page-preview-link', '#auto-reply-template-page-preview-selector-block');
});

$(document).on('change', '#auto-reply-pdf-template', function(e){
    changeEmailTemplatePreview($(e.currentTarget).val(), '#auto-reply-pdf-template-page-preview-link', '#auto-reply-pdf-template-page-preview-link-block', '#auto-reply-pdf-template-page-preview-selector-block');
});

function changeEmailTemplatePreview(templateId, previewLinkId, previewLinkBlockId, selectorBlockId)
{
    $.ajax({
        url: '<?php echo $this->websiteUrl;?>/backend/backend_form/getTemplatePreviewLink/',
        type: 'GET',
        data: {
            'templateId': templateId
        },
        dataType: 'json',
        success: function(response){
            if (parseInt(response.error) === 1) {
                showMessage('template preview error', true, 3000);
                return false
            }

            if (response.responseText.pageUrl !== '') {
                $(document).find(previewLinkId).attr('href', response.responseText.pageUrl);
                $(document).find(previewLinkBlockId).removeClass('hidden');
                $(document).find(selectorBlockId).addClass('omega').removeClass('grid_12').addClass('grid_10');
            } else {
                $(document).find(previewLinkBlockId).addClass('hidden');
                $(document).find(selectorBlockId).removeClass('omega').removeClass('grid_10').addClass('grid_12');
            }
        }
    });
}

</script>
